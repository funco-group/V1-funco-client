# 240321 TIL

## 거래를 통계 내리는 로직 구현

## 거래 테이블

- 거래ID(거래 컬럼 ID)
- 멤버ID
- 코인명
- 구분(매수 매도)
- 수량
- 주문 금액
- 체결가격
- 체결여부
- 팔로우 여부
- 생성일
- 수정일

## 일별통계

- 일별통계ID(일별통계 컬럼 ID)
- 멤버ID
- 날짜
- 손익
    
    ### 손익 구하는 방법
    
    일일 손익 = ~~(A코인 판매액 - A코인 구매액) + (B코인 판매액 - B코인 구매액) + …. + (Z코인 판매액 - Z코인 구매액~~
    
    **⇒ 그런거 필요 없고 각 거래마다 판매액(매도)는 더해주고, 구매액(매수)는 빼주면 됨**
    
    **?코인의 판매액 구하는 방법**
    
    (?코인의 각 매도의 체결 가격 * 수량) 총 합
    
    **?코인의 구매액 구하는 방법**
    
    (?코인의 각 매수의 체결 가격 * 수량)의 총 합
    
    **판매액(가져온 거래가 매도 거래였으면)이면 손익에 더해주고,**
    
    **구매액(가져온 거래가 매수 거래였으면)이면 손익에서 빼준다.**
    
    **일일 손익 = (모든 거래의 판매액, 구매액의 총 합)**
    
    ### 그렇다면 구현 로직
    
    1. 거래 테이블에서 한 오프셋을 가져옴
    2. 그 오프셋을 하나씩 읽음
    3. **거래가 매도라면,** 판매액 계산(체결 가격 * 수량) 후 전역 변수 손익에 더해줌
    4. **거래가 매수라면,** 구매액 계산(체결 가격 * 수량) 후 전역 변수 손익에서 빼줌
    5. 모든 데이터 계산이 끝나면, 전역 변수 손익 값을 넣기
- 수익률
    
    ### 수익률 구하는 방법
    
    수익률 = (기말자산 - 기초자산) / (기초자산) * 100(%를 위한 곱셈)
    
    - 기초자산과 기말자산을 먼저 구해야함
- 누적손익
    
    ### 누적 손익 구하는 방법
    
    누적 손익 = 전날 손익 + 오늘 손익
    
    1. 오늘 손익을 먼저 계산해야함
    2. 전날 손익을 가져옴
    3. **있다면,** 전날 손익 + 오늘 손익
    4. **없다면,** 그냥 오늘 손익만 넣음
- 누적수익률
    
    ### 누적 수익률 구하는 방법
    
    누적 수익률 = 전날 수익률 + 오늘 수익률
    
    1. 오늘 수익률을 먼저 계산해야함
    2. 전날 수익률을 가져옴
    3. **있다면,** 전날 수익률 + 오늘 수익률
    4. **없다면,** 그냥 오늘 수익률만 넣음
- 기초자산
    
    ### 기초자산, 기말자산 구하는 방법
    
    기초자산 = 전날의 기말자산
    
    기말자산 = 통계 하는 시점의 보유 자산(00시)
    
    **※ 회원 가입해서 전날의 기말자산이 없으면?**
    
    - 전날 기말자산이 없다면 1000만원을 기초자산으로 해서 계산!
- 기말자산
    
    ### 기초자산, 기말자산 구하는 방법
    
    기초자산 = 전날의 기말자산
    
    기말자산 = 통계 하는 시점의 보유 자산(00시)
    
    **※ 회원 가입해서 전날의 기말자산이 없으면?**
    
    - 전날 기말자산이 없다면 1000만원을 기초자산으로 해서 계산!
- 생성일
- 수정일

### 월별통계

- 일별통계ID(일별통계 컬럼 ID)
- 멤버ID
- 날짜
- 손익
    
    전달의 각 일자의 모든 손익을 더함
    
- 수익률
    
    ### 수익률 구하는 방법
    
    수익률 = (기말자산 - 기초자산) / (기초자산) * 100(%를 위한 곱셈)
    
    - 기초자산과 기말자산을 먼저 구해야함
- 누적손익
    
    전달의 누적손익 + 이번 달 손익
    
- 누적수익률
    
    전달의 누적 수익률 + 이번 달의 수익률
    
- 기초자산
    
    전달의 첫 날(있는 날 중 가장 첫번째 날)의 기초자산
    
- 기말자산
    
    전달의 마지막 날의 기말자산
    
- 생성일
- 수정일
