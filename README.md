<img src="https://github.com/leetaggg/leetaggg/assets/100212241/16216e7b-0695-4a38-bc11-75bb383a67d5" alt="funco-logo">

---

## 📚 Table of Contents

- [TEAM MEMBER](#team-member)
- [DEPLOY URL](#deploy-url)
- [SPECIFICATION](#specification)
- [INTRODUCTION](#introduction)
- [SKILLS](#skills)
- [SYSTEM ARCHITECTURE](#system-architecture)
- [ERD](#erd)
- [SERVICE LAYOUT](#service-layout)
- [FUNCTION](#function)
- [CHALLENGES](#challenges)

<br>

---
<a name="team-member"></a>
## 🤝 Team Member

| <a href="https://github.com/Woonggss"><img src="https://github.com/Woonggss.png" width="120"/></a> | <a href="https://github.com/devjy39"><img src="https://github.com/devjy39.png" width="120"/></a> | <a href="https://github.com/sunju5402"><img src="https://github.com/sunju5402.png" width="120"/></a> | <a href="https://github.com/leetaggg"><img src="https://github.com/leetaggg.png" width="120"/></a> | <a href="https://github.com/sohy19"><img src="https://github.com/sohy19.png" width="120"/></a> | <a href="https://github.com/hot-ttu"><img src="https://github.com/hot-ttu.png" width="120"/></a> |
|:--------------------------------------------------------------------------------------------------:|:--------------------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------------------------:|:--------------------------------------------------------------------------------------------------:|:------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------:|
|                         [박세웅 [팀장, BE, Infra]](https://github.com/Woonggss)                         |                           [소재열 [CTO, BE]](https://github.com/devjy39)                            |                               [이선주 [BE]](https://github.com/sunju5402)                               |                              [이태호 [BE]](https://github.com/leetaggg)                               |                             [엄소현 [FE]](https://github.com/sohy19)                              |                              [황주영 [FE]](https://github.com/hot-ttu)                              |


---

<a name="deploy-url"></a>
## 🕊️ Deploy URL

- ✅ front-server : https://j10a404.p.ssafy.io
- ✅ back-server : https://j10a404.p.ssafy.io/api

<br>

<a name="specification"></a>
## 📝 Specification
### [API 명세서](https://sohy.notion.site/API-fca64620f83a417eb177c5ced2de30aa?pvs=4) 
### [기능 명세서](https://sohy.notion.site/80af001dca7b4de8aa21170ad5a61b27?pvs=4)
### [화면 정의서](https://sohy.notion.site/UI-6dc26623f4554abcbeb9e6984fb4ced8?pvs=4)
### [프로젝트 문서 바로가기](https://sohy.notion.site/A404-Project-d3293be33e7d488f9637450b178cf211)

<br>

---

<a name="introduction"></a>
## 📢 Introduction

### 서비스 소개 한 줄
- **팔로윙 투자**가 가능한 가상화폐 모의 투자 서비스
- **팔로윙 투자** : 다른 사람에게 투자하고, 그 사람의 투자 내역과 동일하게 자동 투자되고 정산받을 수 있는 기능


<br>

---

<a name="skills"></a>
## 🛠️ Skills


|  분류   |                                                                                                                                                                                                                                                                                                                                                                                                                                          기술 스택                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|:-----:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|  BE   | ![Java](https://img.shields.io/badge/JAVA-v17-3B66BC?style=for-the-badge&logoColor=white) ![SpringBoot](https://img.shields.io/badge/Spring%20Boot-v3.2.3-6DB33F?style=for-the-badge&logo=SpringBoot&logoColor=white) ![Spring Data JPA](https://img.shields.io/badge/Spring%20Data%20JPA-v3.2.3-6DB33F?style=for-the-badge&logoColor=white) ![Spring Security](https://img.shields.io/badge/Spring%20Security-v6.2.2-6DB33F?style=for-the-badge&logo=SpringSecurity&logoColor=white) ![Spring Batch](https://img.shields.io/badge/Spring%20Batch-v5.1.1-6DB33F?style=for-the-badge&logoColor=white) ![QueryDsl](https://img.shields.io/badge/QueryDsl-v5.0.0-4680C2?style=for-the-badge&logoColor=white) ![JWT](https://img.shields.io/badge/JWT-black?style=for-the-badge&logoColor=white) ![OAuth](https://img.shields.io/badge/OAuth-2.0-black?style=for-the-badge&logoColor=white) |
|  FE   |                                                                                                     ![TypeScript](https://img.shields.io/badge/TypeScript-v5.2.2-3178C6?style=for-the-badge&logo=typescript&logoColor=white) ![React](https://img.shields.io/badge/React-v18.2.0-61DAFB?style=for-the-badge&logo=React&logoColor=white) ![Recoil](https://img.shields.io/badge/Recoil-v0.7.7-3578E5?style=for-the-badge&logo=Recoil&logoColor=white) ![Vite](https://img.shields.io/badge/Vite-v5.1.6-646CFF?style=for-the-badge&logo=Vite&logoColor=white) ![Node.js](https://img.shields.io/badge/Node.js-v20.10.0-339933?style=for-the-badge&logo=Node.js&logoColor=white) ![npm](https://img.shields.io/badge/npm-v10.3.0-CB3837?style=for-the-badge&logo=npm&logoColor=white)                                                                                                      |
| Infra |                                          ![AmazonEC2](https://img.shields.io/badge/Amazon%20EC2-FF9900?style=for-the-badge&logo=AmazonEC2&logoColor=white) ![Nginx](https://img.shields.io/badge/Nginx-v1.18.0-009639?style=for-the-badge&logo=Nginx&logoColor=white) ![Ubuntu](https://img.shields.io/badge/Ubuntu-v20.04.6-E95420?style=for-the-badge&logo=Ubuntu&logoColor=white) ![Docker](https://img.shields.io/badge/Docker-v25.04.6-2496ED?style=for-the-badge&logo=Docker&logoColor=white) ![Jenkins](https://img.shields.io/badge/Jenkins-v2.449-D24939?style=for-the-badge&logo=Jenkins&logoColor=white) ![MariaDB](https://img.shields.io/badge/MariaDB-v11.3.2-003545?style=for-the-badge&logo=MariaDB&logoColor=white) ![Redis](https://img.shields.io/badge/Redis-v7.2.4-DC382D?style=for-the-badge&logo=Redis&logoColor=white)                                          |
| 협업도구  |                                                                                                                                                                               ![GitLab](https://img.shields.io/badge/GitLab-FC6D26?style=for-the-badge&logo=GitLab&logoColor=white) ![Figma](https://img.shields.io/badge/Figma-F24E1E?style=for-the-badge&logo=Figma&logoColor=white) ![Mattermost](https://img.shields.io/badge/Mattermost-0058CC?style=for-the-badge&logo=Mattermost&logoColor=white) ![Notion](https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=Notion&logoColor=white) ![Gather](https://img.shields.io/badge/Gather-2196F3?style=for-the-badge&logoColor=white)                                                                                                                                                                                |

<br>

---

<a name="system-architecture"></a>
## 🌐 System Architecture

<img src="https://github.com/leetaggg/leetaggg/assets/100212241/d2987fa3-e180-45b7-94fb-719d6471d9f4">

<br>

<a name="erd"></a>
## 💾 ERD

<img src="https://github.com/leetaggg/leetaggg/assets/100212241/a71db26a-9472-46a0-b652-78d32cc6c474">

<br>

---

<a name="service-layout"></a>
## 🏠 Service Layout

| <img src="https://github.com/leetaggg/leetaggg/assets/100212241/d3edbaa4-da08-4a17-856b-c0a6fcd4c2ba" width="250" alt="landing"> | <img src="https://github.com/leetaggg/leetaggg/assets/100212241/b0a6b5d9-90e0-4850-867e-9fe4a8f701e4" width="250" alt="quote"> | <img src="https://github.com/leetaggg/leetaggg/assets/100212241/557bf206-d3b0-414a-a2d7-bd5f23c54227" width="250" alt="asking-price"> | <img src="https://github.com/leetaggg/leetaggg/assets/100212241/bf53aba6-2a8b-42d2-8e96-acc43a249f60" width="250" alt="trade"> |
|:------------------------------------------------------------------:|:------------------------------------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------------------------------------:|:------------------------------------------------------------------------------------------------------------------------------:|
|                               메인 페이지                               |                                                               시세                                                               |                                                                  호가                                                                   |                                                               거래                                                               |

| <img src="https://github.com/leetaggg/leetaggg/assets/100212241/172be9a2-d586-4faf-b5f6-231a26bacc5c" width="250" alt="Investment-details"> | <img src="https://github.com/leetaggg/leetaggg/assets/100212241/2b496784-4470-488d-b68b-5ec839e87df5" width="250" alt="follow"> | <img src="https://github.com/leetaggg/leetaggg/assets/100212241/2080e186-4adb-4119-bf8d-39c75e89a79c" width="250" alt="ranking"> | <img src="https://github.com/leetaggg/leetaggg/assets/100212241/26398317-60f9-42de-b825-8d4435eaea0a" width="250" alt="notification"> |
|:-------------------------------------------------------------------------------------------------------------------------------------------:|:----------------------------------------------------------------:|:--------------------------------------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------------------------------------:|
|                                                                    투자내역                                                                     |                               팔로우                                |                                                                랭킹                                                                |                                                                  알림                                                                   |

<br>

---

<a name="function"></a>
## ⚙️ Function

### 🎯 가상화폐 거래

- [x] 시간대 별 코인 시세 차트 조회
- [x] 실시간 코인 시세 조회 및 검색
- [x] 시장가(간편 거래) 매수, 매도
- [x] 지정가(예약 거래) 매수, 매도
- [x] 가상화폐 체결, 미체결 내역 조회
- [x] 거래 체결 시 알림
- [x] 관심 코인 추가, 조회, 삭제
- [x] 보유 코인 조회

### 🎯 투자내역

- [x] 보유자산 목록 조회
- [x] 일별, 월별 투자 손익 조회
- [x] 기간/거래종류/자산종류 별 자산 변동 내역 조회
- [x] 팔로잉, 팔로워 투자 자산 조회
- [x] 팔로우 거래, 보유 내역 조회
- [x] 모든 가상화폐 미체결 거래 내역 조회

### 🎯 팔로우

- [x] 팔로우 시 자산 동기화
- [x] 팔로잉의 투자에 따라 자동 투자
- [x] 팔로우 정산 시 알림

### 🎯 랭킹

- [x] 정각 기준 30분 마다 랭킹 업데이트
- [x] 총 팔로워 금액에 따른 랭킹 조회
- [x] 총 자산에 따른 랭킹 조회

### 🎯 회원

💡 회원은 Spring Security & JWT & Oauth2.0 사용하여 구글 소셜 로그인 구현

- [x] 회원 가입
- [x] 로그인, 로그아웃
- [x] 유저 투자 포트폴리오 조회 
- [x] 닉네임 수정
- [x] 한줄 소개 수정

### ⏰ Batch

- QueryDslItemReader를 활용하여 Chunk-oriented Processing으로 데이터를 처리하여 저장
- 매일 오전 6시에 전날의 거래 내역으로 일별 통계 내역을 생성하는 Job
  - 체결 내역 테이블의 데이터를 누적 계산하여 도출된 손익을 임시 손익 테이블에 저장하는 Step
  - 임시 손익 테이블의 데이터를 일별 통계 테이블에 저장하는 Step
- 매월 1일 자정에 전달의 일별 통계 내역으로 월별 통계 내역을 생성하는 Job 실행
  - 전달의 일별 통계 테이블의 데이터를 누적 계산하여 월별 통계 테이블에 저장하는 Step

<a name="challenges"></a>
## 💪 Challenges

### FrontEnd
- 100여 개의 코인의 시세를 실시간 웹소켓으로 받아오는데 보유 및 관심 코인 리스트에서는 백여 개의 코인 시세를 실시간으로 받아올 필요가 없습니다
- 웹소켓을 모듈화 하여 다른 파일에서도 웹소켓의 send 요청을 보낼 수 있도록 했습니다

### 랭킹 정렬
- 랭킹은 어쩔 수 없이 매번 총 자산과 총 팔로워 금액을 구해야하기 때문에 성능에 대한 고민이 있을 수 밖에 없었습니다.
- 실시간은 쿼리가 많이 발생하여 너무 서버에 부담이 갈 것 같아서 30분마다 스케줄링을 돌려 계산을 하고 계산한 값들은 레디스에 넣도록 했습니다.
  - 조회가 많이 일어나기 때문에 redis 사용을 고려했습니다.
- 정렬 기능을 필요로 했기 때문에 레디스의 ZSet을 활용하여 정렬을 하였고 조회할 때마다 레디스에서 캐싱하여 보여주었습니다.
  - ZSet 연산은 O(log(n))으로 단순히 java의 timsort, Arrays.sort()의 평균 O(nlog(n))보다 훨씬 효율적입니다.
  - zrange의 시간복잡도는 O(log(n) + m(반환받는 멤버들의 개수))로 효율적으로 페이징 처리를 했습니다.


### 지정가 예약 거래
- 서버에서 실시간으로 등록된 예약 거래가 처리되어야 했다.
- 서버가 웹소켓 클라이언트가 돼서 실시간으로 메모리에 코인 시세들을 받아와 저장한다.
- 예약 거래를 동시성 처리를 위해 ConcurrentHashMap으로 관리했고 각 코인 별 매수, 매도 우선순위 큐를 사용해 시세를 감지하여 거래가 될 수 있는 데이터 또는 하나의 데이터만 확인하도록 O(1)로 구현했습니다.
- 성능 최적화를 위해 예약 거래에 등록된 코인의 시세 데이터만 유동적으로 받아오도록 웹소켓 메시지를 동적으로 처리했습니다.

### 정확한 소수점 연산
- 핀테크 프로젝트 특성 상 정확한 소수점 연산을 다뤄야 함. 우리의 경우 정확한 코인 수량과 가격에 대한 정확하고 일관적인 연산 결과가 필요.
- BigDecimal Utility class 를 만들어 전역으로 사용함으로써 일관적인 연산과 정확한 소수점 연산을 할 수 있게 됐다.

### 페이징 쿼리 최적화
- Offset 방식의 Pagination은 Offset 값이 커질수록 그만큼의 row를 읽어야하므로 성능저하가 일어납니다.
- 가상화폐 거래 사이트 특성상 무수히 많은 거래 내역이 저장 될 것이므로 Cursor Pagination을 사용하여 조회 성능을 최적화 하였습니다.
- 이러한 방식은 Batch의 ItemReader에도 적용하였습니다.
- 전날의 모든 거래 내역으로 일별 통계를 생성하는 Job에서 QueryDslNoOffsetItemReader를 사용하여  Offset 없이 Chunk 단위로 데이터를 읽어 프로세싱합니다.
